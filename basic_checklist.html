<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Car Information Checklist</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <script src="https://unpkg.com/html2canvas@1.0.0-rc.1/dist/html2canvas.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

    <!-- Include Bootstrap CSS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Custom CSS Styles -->
    <link rel="stylesheet" href="styles.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />

</head>

<body>
    <!-- Navbar -->
    <div id="navbar"></div>

    <section class="container">

        <form class="mt-4">
            <!-- Year -->
            <div class="mb-3">
                <label for="year" class="form-label">Year</label>
                <input type="text" class="form-control input-field-info"  id="year" placeholder="Enter the year of the car" />
            </div>

            <!-- Make -->
            <div class="mb-3">
                <label for="make" class="form-label">Make</label>
                <input type="text" class="form-control input-field-info" id="make" placeholder="Enter the make of the car" />
            </div>

            <!-- Model -->
            <div class="mb-3">
                <label for="model" class="form-label">Model</label>
                <input type="text" class="form-control input-field-info" id="model" placeholder="Enter the model of the car" />
            </div>

            <!-- Asking Price/Phone# -->
            <div class="mb-3">
                <label for="price" class="form-label">Asking Price/Phone#</label>
                <input type="text" class="form-control input-field-info" id="price"
                    placeholder="Enter the asking price or phone number" />
            </div>

            <!-- Trade-in Value -->
            <div class="mb-3">
                <label for="trade-in" class="form-label">Trade-in Value</label>
                <input type="text" class="form-control " id="trade-in" placeholder="Enter the trade-in value" />
            </div>

            <!-- Additional Checklist Items - Body Condition -->
            <h2>Body Condition</h2>
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="scratches" />
                <label class="form-check-label" for="scratches">Scratches</label>
                <input type="text" class="form-control input-field" id="scratches-details"
                    placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="dents" />
                <label class="form-check-label" for="dents">Dents</label>
                <input type="text" class="form-control input-field" id="dents-details" placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="windshield" />
                <label class="form-check-label" for="windshield">Windshield (chips or cracks?)</label>
                <input type="text" class="form-control input-field" id="windshield-details"
                    placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="headlights" />
                <label class="form-check-label" for="headlights">Headlights (foggy?)</label>
                <input type="text" class="form-control input-field" id="headlights-details"
                    placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="inspection-sticker" />
                <label class="form-check-label" for="inspection-sticker">Inspection Sticker Current?</label>
                <input type="text" class="form-control input-field" id="inspection-sticker-details"
                    placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="rusty-brake-rotors" />
                <label class="form-check-label" for="rusty-brake-rotors">Rusty Brake Rotors?</label>
                <input type="text" class="form-control input-field" id="rusty-brake-rotors-details"
                    placeholder="Enter details" />
            </div>

            <!-- Additional Checklist Items - Wheels -->
            <h2>Wheels</h2>
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="tire-tread" />
                <label class="form-check-label" for="tire-tread">Tire Tread</label>
                <input type="text" class="form-control input-field" id="tire-tread-details"
                    placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="all-tires-same" />
                <label class="form-check-label" for="all-tires-same">All 4 tires/wheels the same?</label>
                <input type="text" class="form-control input-field" id="all-tires-same-details"
                    placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="wheel-damage" />
                <label class="form-check-label" for="wheel-damage">Wheel damage?</label>
                <input type="text" class="form-control input-field" id="wheel-damage-details"
                    placeholder="Enter details" />
            </div>

            <!-- Additional Checklist Items - Interior -->
            <h2>Interior</h2>
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="rips-on-seats" />
                <label class="form-check-label" for="rips-on-seats">Rips on seats</label>
                <input type="text" class="form-control input-field" id="rips-on-seats-details"
                    placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="car-options" />
                <label class="form-check-label" for="car-options">Car Options (Navi, sunroof, etc)</label>
                <input type="text" class="form-control input-field" id="car-options-details"
                    placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="headliner" />
                <label class="form-check-label" for="headliner">Headliner (saggy?)</label>
                <input type="text" class="form-control input-field" id="headliner-details"
                    placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="transmission" />
                <label class="form-check-label" for="transmission">Automatic/Manual</label>
                <input type="text" class="form-control input-field" id="transmission-details"
                    placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="steering-wheel" />
                <label class="form-check-label" for="steering-wheel">Steering wheel (worn?)</label>
                <input type="text" class="form-control input-field" id="steering-wheel-details"
                    placeholder="Enter details" />
            </div>


            <!-- Additional Checklist Items - Under the Car -->
            <h2>Under the Car</h2>
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="engine-leaks" />
                <label class="form-check-label" for="engine-leaks">Leaks (near engine and rear diff)</label>
                <input type="text" class="form-control input-field" id="engine-leaks-input"
                    placeholder="Enter details" />

            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="rust" />
                <label class="form-check-label" for="rust">Rust (exhaust, frame, body, etc)</label>
                <input type="text" class="form-control input-field" id="rust-input" placeholder="Enter details" />
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="suspension" />
                <label class="form-check-label" for="suspension">Suspension (tie rods, ball joints, shocks, axle,
                    etc)</label>
                <input type="text" class="form-control input-field" id="suspension-input" placeholder="Enter details" />

            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="frame-damage" />
                <label class="form-check-label" for="frame-damage">Frame Damage (from collision)</label>
                <input type="text" class="form-control input-field" id="rame-damage-input"
                    placeholder="Enter details" />
            </div>

            <div class="review-section">
                <h3>Checklist information review:</h3>
                <div class="car-info"></div>
                <div>How many items did you check: <span id="checked-count">0/18</span></div>

                <p>Comments you added:</p>
                <div class="review-text"></div>
            </div>



        </form>
        <div class="form-check" style="text-align: left; padding: 20pt;">
            <button type="button" class="btn btn-primary" id="exportPdfButton">Export to PDF</button>
        </div>
    </section>


    <script>
        $(document).ready(function () {
            // Function to update the checked count
            function updateCheckedCount() {
                // Get all the checkboxes with the class "form-check-input"
                const checkboxes = $('.form-check-input');

                // Initialize a variable to count the checked checkboxes
                let checkedCount = 0;

                // Loop through the checkboxes and count the checked ones
                checkboxes.each(function () {
                    if ($(this).prop('checked')) {
                        checkedCount++;
                    }
                });

                // Update the text of the "checked-count" element
                const checkedCountElement = $('#checked-count');
                checkedCountElement.text(checkedCount + '/18');
            }

            // Attach an event listener to each checkbox to update the count when checked/unchecked
            $('.form-check-input').change(updateCheckedCount);

            // Call the function initially to set the count to 0/24
            updateCheckedCount();
        });
    </script>


    <script>
        $(document).ready(function () {
            // Attach a change event listener to each checkbox and input field
            $('input[type="checkbox"]').change(updateReviewText);
            $('.input-field').on('input', updateReviewText);
            $('.input-field-info').on('input', updateReviewText);
            // Add a click event listener to the "Export to PDF" button
            // Add a click event listener to the "Export to PDF" button
            $('#exportPdfButton').click(function () {
                // Check if at least one comment is added (text is not empty)
                if (isAtLeastOneCommentAdded()) {
                    exportToPdf();
                } else {
                    alert('Please add at least one comment before exporting to PDF.');
                }
            });

            function updateReviewText() {
                // Initialize an empty string for the review text
                let textToAdd = '';
                let carInfo='';
                // Loop through the checkboxes and input fields
                $('input[type="checkbox"]').each(function (index) {
                    const inputField = $('.input-field').eq(index);

                    if ($(this).is(':checked')) {
                        // Checkbox is checked, add text to review section with enumeration
                        const checkboxLabel = $(this).next('label').text();
                        const inputValue = inputField.val();

                        if ($.trim(inputValue) !== '') {
                            // Add enumeration and line break 
                            textToAdd += `<div style="display: flex; align-items: center;"><div>${index + 1}.</div><div>${checkboxLabel}: ${inputValue}</div></div>`;
                        }
                    }
    
                });
                const yearInputValue = $('#year').val();
                const makeInputValue = $('#make').val();
                const modelInputValue = $('#model').val();
                const priceInputValue = $('#price').val();
                const tradeInputValue = $('#trade-in').val();

                if ($.trim(yearInputValue) !== '') {
                    carInfo += `<div>Year: ${yearInputValue}</div>`;
                }

                if ($.trim(makeInputValue) !== '') {
                    carInfo += `<div>Make: ${makeInputValue}</div>`;
                }
                if ($.trim(modelInputValue) !== '') {
                    carInfo += `<div>Model: ${modelInputValue}</div>`;
                }
                if ($.trim(priceInputValue) !== '') {
                    carInfo += `<div>Price: ${priceInputValue}</div>`;
                }
                if ($.trim(tradeInputValue) !== '') {
                    carInfo += `<div>Trade-In: ${tradeInputValue}</div>`;
                }
                $('.car-info').html(carInfo );

                // Update the review text element with HTML
                $('.review-text').html(textToAdd);
            }

            function exportToPdf() {
                // Create a new jsPDF instance
                window.jsPDF = window.jspdf.jsPDF;

                const pdf = new jsPDF(
                    {
                        'orientation': 'p',
                        'unit': 'pt',
                        'format': 'letter',
                        'putOnlyUsedFonts': true,
                    }
                );

                // Get the review text content
                const reviewText = $('.review-section').html();

                // Get the current date in a formatted string
                const now = new Date();
                const formattedDate = now.toLocaleDateString().replaceAll('/', '-');

                // Generate a filename with the date
                const filename = `review-${formattedDate}.pdf`;

                // Save the PDF with the updated filename
                pdf.html(reviewText, {
                    width: 580,
                    windowWidth: 580,
                    margin: 15,
                    callback: function () {
                        console.log(reviewText); // to debug
                        pdf.save(filename);
                    }
                });
            }
            // Helper function to check if at least one comment is added
            function isAtLeastOneCommentAdded() {
                let atLeastOneCommentAdded = false;

                // Loop through input fields and check if any has non-empty value
                $('.input-field').each(function () {
                    if ($.trim($(this).val()) !== '') {
                        atLeastOneCommentAdded = true;
                        return false; // Exit the loop if a non-empty input is found
                    }
                });

                return atLeastOneCommentAdded;
            }
        });
    </script>
    <script>
        $(document).ready(function () {
            $("#navbar").load("navi.html");
        });
    </script>
    <!-- Include Bootstrap JavaScript and jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>



</body>

</html>